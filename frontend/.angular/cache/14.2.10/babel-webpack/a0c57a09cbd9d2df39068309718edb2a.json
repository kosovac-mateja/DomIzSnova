{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/kosov/OneDrive/Dokumenti/UredjivanjeProstoraAPP/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Korisnik } from '../models/korisnik';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/korisnik.service\";\nimport * as i2 from \"../services/mejl.service\";\nimport * as i3 from \"../services/provera.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"../zaglavlje-klijent/zaglavlje-klijent.component\";\nimport * as i8 from \"../zaglavlje-agencija/zaglavlje-agencija.component\";\n\nfunction PromenaLozinkeComponent_app_zaglavlje_klijent_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-zaglavlje-klijent\");\n  }\n}\n\nfunction PromenaLozinkeComponent_app_zaglavlje_agencija_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-zaglavlje-agencija\");\n  }\n}\n\nexport class PromenaLozinkeComponent {\n  constructor(korisnikServis, mejlServis, proveraServis, ruter) {\n    this.korisnikServis = korisnikServis;\n    this.mejlServis = mejlServis;\n    this.proveraServis = proveraServis;\n    this.ruter = ruter;\n    this.korisnik = new Korisnik();\n    this.privremeneLozinke = [];\n    this.staraLozinka = '';\n    this.novaLozinka = '';\n    this.potvrdaNoveLozinke = '';\n    this.greska = '';\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      let korisnickoIme = sessionStorage.getItem('korisnik');\n      _this.privremeneLozinke = yield _this.mejlServis.dohvatiPrivremeneLozinke(korisnickoIme);\n\n      _this.korisnikServis.dohvatiKorisnika(korisnickoIme).subscribe(korisnik => {\n        _this.korisnik = korisnik;\n      });\n    })();\n  }\n\n  promeniLozinku() {\n    if (this.staraLozinka != this.korisnik.lozinka) {\n      let ind = false;\n\n      for (const privremena of this.privremeneLozinke) {\n        if (privremena.lozinka == this.staraLozinka) {\n          if (new Date(privremena.vremeIsteka) > new Date()) {\n            ind = true;\n            break;\n          }\n        }\n      }\n\n      if (!ind) {\n        this.greska = 'Uneta stara lozinka nije ispravna';\n        return;\n      }\n    } else if (this.novaLozinka != this.potvrdaNoveLozinke) {\n      this.greska = 'Unete lozinke se ne poklapaju';\n      return;\n    } else if (this.novaLozinka == this.staraLozinka) {\n      this.greska = 'Nova lozinka ne sme biti ista kao stara';\n      return;\n    }\n\n    let provera = this.proveraServis.proveraLozinka(this.novaLozinka);\n\n    if (provera != 'ok') {\n      this.greska = provera;\n      return;\n    }\n\n    this.korisnikServis.azurirajLozinku(this.korisnik.korisnickoIme, this.novaLozinka).subscribe(res => {\n      alert('Lozinka uspesno promenjena!');\n      sessionStorage.clear();\n      this.ruter.navigate(['/']);\n    });\n  }\n\n}\n\nPromenaLozinkeComponent.ɵfac = function PromenaLozinkeComponent_Factory(t) {\n  return new (t || PromenaLozinkeComponent)(i0.ɵɵdirectiveInject(i1.KorisnikService), i0.ɵɵdirectiveInject(i2.MejlService), i0.ɵɵdirectiveInject(i3.ProveraService), i0.ɵɵdirectiveInject(i4.Router));\n};\n\nPromenaLozinkeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PromenaLozinkeComponent,\n  selectors: [[\"app-promena-lozinke\"]],\n  decls: 30,\n  vars: 6,\n  consts: [[4, \"ngIf\"], [1, \"container\"], [1, \"row\"], [1, \"col-md-6\"], [1, \"form-group\"], [\"for\", \"staraLozinka\"], [\"type\", \"password\", \"id\", \"staraLozinka\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"novaLozinka\"], [\"type\", \"password\", \"id\", \"novaLozinka\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"potvrdaNoveLozinke\"], [\"type\", \"password\", \"id\", \"potvrdaNoveLozinke\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"text-danger\"]],\n  template: function PromenaLozinkeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, PromenaLozinkeComponent_app_zaglavlje_klijent_0_Template, 1, 0, \"app-zaglavlje-klijent\", 0);\n      i0.ɵɵtemplate(1, PromenaLozinkeComponent_app_zaglavlje_agencija_1_Template, 1, 0, \"app-zaglavlje-agencija\", 0);\n      i0.ɵɵelementStart(2, \"div\", 1)(3, \"h3\");\n      i0.ɵɵtext(4, \"Promena lozinke\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"div\", 2)(6, \"div\", 3)(7, \"div\", 4)(8, \"label\", 5);\n      i0.ɵɵtext(9, \"Stara lozinka\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"input\", 6);\n      i0.ɵɵlistener(\"ngModelChange\", function PromenaLozinkeComponent_Template_input_ngModelChange_10_listener($event) {\n        return ctx.staraLozinka = $event;\n      });\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(11, \"div\", 2)(12, \"div\", 3)(13, \"div\", 4)(14, \"label\", 7);\n      i0.ɵɵtext(15, \"Nova lozinka\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"input\", 8);\n      i0.ɵɵlistener(\"ngModelChange\", function PromenaLozinkeComponent_Template_input_ngModelChange_16_listener($event) {\n        return ctx.novaLozinka = $event;\n      });\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(17, \"div\", 2)(18, \"div\", 3)(19, \"div\", 4)(20, \"label\", 9);\n      i0.ɵɵtext(21, \"Potvrda nove lozinke\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"input\", 10);\n      i0.ɵɵlistener(\"ngModelChange\", function PromenaLozinkeComponent_Template_input_ngModelChange_22_listener($event) {\n        return ctx.potvrdaNoveLozinke = $event;\n      });\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(23, \"div\", 2)(24, \"div\", 3)(25, \"div\", 4)(26, \"button\", 11);\n      i0.ɵɵlistener(\"click\", function PromenaLozinkeComponent_Template_button_click_26_listener() {\n        return ctx.promeniLozinku();\n      });\n      i0.ɵɵtext(27, \"Promeni lozinku\");\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(28, \"p\", 12);\n      i0.ɵɵtext(29);\n      i0.ɵɵelementEnd()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.korisnik.tip == \"klijent\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.korisnik.tip == \"agencija\");\n      i0.ɵɵadvance(9);\n      i0.ɵɵproperty(\"ngModel\", ctx.staraLozinka);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngModel\", ctx.novaLozinka);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngModel\", ctx.potvrdaNoveLozinke);\n      i0.ɵɵadvance(7);\n      i0.ɵɵtextInterpolate(ctx.greska);\n    }\n  },\n  dependencies: [i5.NgIf, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgModel, i7.ZaglavljeKlijentComponent, i8.ZaglavljeAgencijaComponent],\n  styles: [\".container[_ngcontent-%COMP%] {\\r\\n    margin-top: 20px;\\r\\n  }\\r\\n  \\r\\n  h3[_ngcontent-%COMP%] {\\r\\n    margin-bottom: 20px;\\r\\n  }\\r\\n  \\r\\n  .form-group[_ngcontent-%COMP%] {\\r\\n    margin-bottom: 20px;\\r\\n  }\\r\\n  \\r\\n  .btn-primary[_ngcontent-%COMP%] {\\r\\n    background-color: lightblue;\\r\\n    color: black;\\r\\n    border-color: black;\\r\\n  }\\r\\n  \\r\\n  .text-danger[_ngcontent-%COMP%] {\\r\\n    margin-top: 5px;\\r\\n    font-size: 14px;\\r\\n  }\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb21lbmEtbG96aW5rZS5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0lBQ0ksZ0JBQWdCO0VBQ2xCOztFQUVBO0lBQ0UsbUJBQW1CO0VBQ3JCOztFQUVBO0lBQ0UsbUJBQW1CO0VBQ3JCOztFQUVBO0lBQ0UsMkJBQTJCO0lBQzNCLFlBQVk7SUFDWixtQkFBbUI7RUFDckI7O0VBRUE7SUFDRSxlQUFlO0lBQ2YsZUFBZTtFQUNqQiIsImZpbGUiOiJwcm9tZW5hLWxvemlua2UuY29tcG9uZW50LmNzcyIsInNvdXJjZXNDb250ZW50IjpbIi5jb250YWluZXIge1xyXG4gICAgbWFyZ2luLXRvcDogMjBweDtcclxuICB9XHJcbiAgXHJcbiAgaDMge1xyXG4gICAgbWFyZ2luLWJvdHRvbTogMjBweDtcclxuICB9XHJcbiAgXHJcbiAgLmZvcm0tZ3JvdXAge1xyXG4gICAgbWFyZ2luLWJvdHRvbTogMjBweDtcclxuICB9XHJcbiAgXHJcbiAgLmJ0bi1wcmltYXJ5IHtcclxuICAgIGJhY2tncm91bmQtY29sb3I6IGxpZ2h0Ymx1ZTtcclxuICAgIGNvbG9yOiBibGFjaztcclxuICAgIGJvcmRlci1jb2xvcjogYmxhY2s7XHJcbiAgfVxyXG4gIFxyXG4gIC50ZXh0LWRhbmdlciB7XHJcbiAgICBtYXJnaW4tdG9wOiA1cHg7XHJcbiAgICBmb250LXNpemU6IDE0cHg7XHJcbiAgfVxyXG4gICJdfQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Korisnik","i0","PromenaLozinkeComponent","constructor","korisnikServis","mejlServis","proveraServis","ruter","ngOnInit","korisnickoIme","sessionStorage","getItem","privremeneLozinke","dohvatiPrivremeneLozinke","dohvatiKorisnika","subscribe","korisnik","promeniLozinku","staraLozinka","lozinka","ind","privremena","Date","vremeIsteka","greska","novaLozinka","potvrdaNoveLozinke","provera","proveraLozinka","azurirajLozinku","res","alert","clear","navigate","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\kosov\\OneDrive\\Dokumenti\\UredjivanjeProstoraAPP\\frontend\\src\\app\\promena-lozinke\\promena-lozinke.component.ts","C:\\Users\\kosov\\OneDrive\\Dokumenti\\UredjivanjeProstoraAPP\\frontend\\src\\app\\promena-lozinke\\promena-lozinke.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { KorisnikService } from '../services/korisnik.service';\nimport { Korisnik } from '../models/korisnik';\nimport { PrivremenaLozinka } from '../models/privremenaLozinka';\nimport { MejlService } from '../services/mejl.service';\nimport { Router } from '@angular/router';\nimport { ProveraService } from '../services/provera.service';\n\n@Component({\n  selector: 'app-promena-lozinke',\n  templateUrl: './promena-lozinke.component.html',\n  styleUrls: ['./promena-lozinke.component.css'],\n})\nexport class PromenaLozinkeComponent implements OnInit {\n  constructor(\n    private korisnikServis: KorisnikService,\n    private mejlServis: MejlService,\n    private proveraServis: ProveraService,\n    private ruter: Router\n  ) {}\n\n  async ngOnInit() {\n    let korisnickoIme = sessionStorage.getItem('korisnik');\n    this.privremeneLozinke = await this.mejlServis.dohvatiPrivremeneLozinke(\n      korisnickoIme\n    );\n    this.korisnikServis\n      .dohvatiKorisnika(korisnickoIme)\n      .subscribe((korisnik: Korisnik) => {\n        this.korisnik = korisnik;\n      });\n  }\n\n  promeniLozinku() {\n    if (this.staraLozinka != this.korisnik.lozinka) {\n      let ind = false;\n      for (const privremena of this.privremeneLozinke) {\n        if (privremena.lozinka == this.staraLozinka) {\n          if (new Date(privremena.vremeIsteka) > new Date()) {\n            ind = true;\n            break;\n          }\n        }\n      }\n      if (!ind) {\n        this.greska = 'Uneta stara lozinka nije ispravna';\n        return;\n      }\n    } else if (this.novaLozinka != this.potvrdaNoveLozinke) {\n      this.greska = 'Unete lozinke se ne poklapaju';\n      return;\n    } else if (this.novaLozinka == this.staraLozinka) {\n      this.greska = 'Nova lozinka ne sme biti ista kao stara';\n      return;\n    }\n    let provera = this.proveraServis.proveraLozinka(this.novaLozinka);\n    if (provera != 'ok') {\n      this.greska = provera;\n      return;\n    }\n    this.korisnikServis\n      .azurirajLozinku(this.korisnik.korisnickoIme, this.novaLozinka)\n      .subscribe((res) => {\n        alert('Lozinka uspesno promenjena!');\n        sessionStorage.clear();\n        this.ruter.navigate(['/']);\n      });\n  }\n\n  korisnik: Korisnik = new Korisnik();\n  privremeneLozinke: PrivremenaLozinka[] = [];\n\n  staraLozinka: string = '';\n  novaLozinka: string = '';\n  potvrdaNoveLozinke: string = '';\n\n  greska: string = '';\n}\n","<app-zaglavlje-klijent *ngIf=\"korisnik.tip=='klijent'\"></app-zaglavlje-klijent>\n<app-zaglavlje-agencija *ngIf=\"korisnik.tip=='agencija'\"></app-zaglavlje-agencija>\n\n<div class=\"container\">\n    <h3>Promena lozinke</h3>\n    <div class=\"row\">\n        <div class=\"col-md-6\">\n            <div class=\"form-group\">\n                <label for=\"staraLozinka\">Stara lozinka</label>\n                <input type=\"password\" class=\"form-control\" id=\"staraLozinka\" [(ngModel)]=\"staraLozinka\">\n            </div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-md-6\">\n            <div class=\"form-group\">\n                <label for=\"novaLozinka\">Nova lozinka</label>\n                <input type=\"password\" class=\"form-control\" id=\"novaLozinka\" [(ngModel)]=\"novaLozinka\">\n            </div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-md-6\">\n            <div class=\"form-group\">\n                <label for=\"potvrdaNoveLozinke\">Potvrda nove lozinke</label>\n                <input type=\"password\" class=\"form-control\" id=\"potvrdaNoveLozinke\" [(ngModel)]=\"potvrdaNoveLozinke\">\n            </div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-md-6\">\n            <div class=\"form-group\">\n                <button class=\"btn btn-primary\" (click)=\"promeniLozinku()\">Promeni lozinku</button>\n            </div>\n        </div>\n    </div>\n    <p class=\"text-danger\">{{ greska }}</p>\n</div>\n"]},"metadata":{},"sourceType":"module"}